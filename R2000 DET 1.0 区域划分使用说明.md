

# **R2000 DET** **1.0** **区域****划分使用说明**

## 区域划分软件功能及界面**



•**实现****R2000 30****米的区域划分（主要针对常用的****30****米型号）****;**

•**实现分组，分区域**

•**区域新增、删除**

•**分组新增、删除**

•**当前****X,Y****轴坐标**

•**显示当前鼠标所在位置与中心点的距离，以便距离划分**

•**所在区域检测**

•**配置的保存及删除**

•**理论上可以建立****65535****个分组，每个分组可以有****65535****个区域**

•**注意：如果已有****Config****配置文件，没有“打开配置文件”的操作，所有的新建区域将覆盖原有****Config****配置文件！**

•**屏幕分辨率不能低于****1920X1080**

![image-20200409092708327](C:\Users\dxiao\AppData\Roaming\Typora\typora-user-images\image-20200409092708327.png)

## **区域划分软件使用说明**



•**画完区域后****必须****点击“封闭区域”，****会自动封闭区域****！**

•**每完成一个“封闭区域”会自动新增一个区域，无需手动增加**

•**如果有一个无任何区域划分的组，将无法新建分组**

•**退出请点击“退出”或右上角的“****X****”**

•**保存的配置文件固定为“****Config****”**

•**打开的配置文件也****固定为“****Config****”**

•**建立配置文件之后，如需****API****调用，需将“****Config****”文件保存到****AGV****运行主程序相同的文件夹中**

•**移动鼠标可以在右侧提示文本内看到鼠标所在的区域编号**

•**增加相关提示在文本框内、及确认对话框**

![image-20200409092719908](C:\Users\dxiao\AppData\Roaming\Typora\typora-user-images\image-20200409092719908.png)

## **API****实现功能**



•**载入“****Config****”配置文件，需要在运行时候的文件夹同一路径，但可在程序中修改成绝对路径**

•**启用一个指定分组**

•**停止指定一个分组**

•**获取当前配置所有分组数**

•**获取当前组的区域****数**

•**获取当前分组状态（是否有障碍物在区域内），目前固定是连续两个点在区域内才算在区域内，否则认为是干扰点，同时也可启用****R2000****自带的过滤功能。**

•**结束****API****，释放内存**

•**说明：在画区域的软件中定义蓝色区域（****480,480****）为中心点，而保存在****Config****的坐标是窗口蓝色区域的实际坐标，该坐标的原点是蓝色区域最左上角。所以，在实际进行****R2000****坐标转换时候，流程是：极坐标****->****二****维坐标（假设为****x1,y1****），所以计算出来的二维坐标将****（****480,480****）设置为****原点，所以相对于（****480,480****）实际坐标为（****x1+480****，****y1+480****），****API****在进行比对时候会自动进行转换。**

## **API****使用方法****——****函数篇：**



•**b****ool** **InitAPI****()****：用于载入****Config****文件，并进行初始化，返回类型为布尔类型，即：****true****为成功，****false****为失败，如果失败请检查****Config****文件是否存在、文件格式是否正确**

•**bool** **StartGroup****(****int** **i_Group****):****启用一个分组，参数为****Config****中的分组编号，从****1****开始，返回成功或失败**

•**bool** **StopGroup****(****int** **i_Group****)****：停止指定一****个分组，参数为****Config****中的分组编号，从****1****开始，返回成功或****失败**

•**int** **AllGroupNum****：当前配置文件所有分组数**

•**int** **ZoneofGroup****：当前****组的区域****数**

•**int** **Group****：当前****使用的分组****编号**

•**bool** **b_Init****：初始化状态，****true****为已经初始化成功**

•**bool \*****GetStatus****(char******* **PointBuffer****)****：获取当前分组状态（是否有障碍物在区域内），返回为****bool****数组，包含每个区域状态，****bool****数组个数为当前分组区域个数，参数为****R2000****原始数据，****数据类型为“****B****”！**

•**bool** **EndAPI****()****：****结束****API****，释放****内存，程序退出前请务必使用，避免内存泄漏！**

**API****使用方法****——****CMakeLists.txt****编写（主程序名为：****r2000test.cpp****）**



**set(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -Wall -****std****=****c++****0x -****Wfatal****-errors")**

**include_directories****(**

 **include**

 **${****catkin_INCLUDE_DIRS****}**

**)**

**add_library****(R2000DETAPI**

 **src****/R2000DETAPI.cpp**

**)**



**add_executable****(r2000test** **src****/r2000test.cpp)**

**target_link_libraries****(r2000test ${****catkin_LIBRARIES****})**

**target_link_libraries****(r2000test**

 **R2000DETAPI**

**)**

## **API****使用****DEMO****，在****ROS****中运行**



•**在相关程序或头文件中包含****API****头文件：****#include “R2000DET.h”****，注意大小写。**

•**DEMO****代码如下：**

**m****ain()**

**{**

  **if (****InitAPI****())//****初始化****API**

   **{**

​     **StartGroup****(1);//****启用分组****1****。**

   **}**

  **while(****ros****::ok())**

   **{**

​     **bool \* Zone1Status=** **GetStatus****(R2000_Buffer);//****获取启用分组中区域状态**

​     **//****以下添加对各区域返回值后的逻辑处理**

   **}**

   **EndAPI****();//****先结束****API****，之后在结束****/****退出主程序**

**}**

**其他说明**



•**API****在****Windows****中模拟测试，基本功能测试通过**

•**由于屏幕设置的是****960X960****，中间点是（****480,480****），精度在****6.25mm****每个像素点（程序中判断距离差值在****0.1****内），但需要确认。**

•**自己写的程序在****ROS****中使用****catkin_make****编译通过，并可运行****。**

•![image-20200409092523366](C:\Users\dxiao\AppData\Roaming\Typora\typora-user-images\image-20200409092523366.png)